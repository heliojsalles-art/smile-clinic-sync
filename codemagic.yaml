# The name of your workflow, which will be displayed in the Codemagic UI.
workflows:
  android-release:
    name: Android Release Build
    # Specify the build machine type.
    instance_type: mac_mini_m2 #

    # Environment variables (optional, for code signing)
    environment:
      vars:
        PACKAGE_NAME: "sa" # Replace with your package name

    # Define the steps for the build process.
    steps:
      scripts:
  - name: Clone repository
    script: |
        git clone https://github.com/username/repo.git
        script: - cd $sa
        script: - git checkout $CM_BRANCH

      - name: Set up Flutter
        script:
          # This uses the version/channel defined in the "environment" section
          - flutter channel stable
          - flutter upgrade
          - flutter doctor

      - name: Get dependencies
        script:
          - flutter pub get

      # Optional: Add a step for build versioning (e.g., using the built-in build number)
      - name: Set Android build number and version
        script:
          - echo "flutter build name: 1.0.$CM_BUILD_NUMBER"
          - echo "flutter build number: $CM_BUILD_NUMBER"

      - name: Build Android APK
        script:
          - flutter build apk --release --build-name=1.0.$CM_BUILD_NUMBER --build-number=$CM_BUILD_NUMBER #

    # Artifacts to export (the generated APK)
    artifacts:
      - app/build/outputs/apk/release/sa.apk #
    
    publishing:
      # Optional: Configure email publishing
      email:
        recipients:
          - heliojsalles@gmail.com
